<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PCPartsHub Pro</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
--bg:#0b0e14;
--panel:#121723;
--panel2:#161c2e;
--accent:#4f7cff;
--text:#e6e8ee;
--muted:#9aa1b2;
--danger:#ff5c5c;
--success:#28c76f;
--radius:14px;
}

*{margin:0;padding:0;box-sizing:border-box}

body{
font-family:Inter,sans-serif;
background:radial-gradient(1200px 600px at 20% -10%,#16204a,transparent),var(--bg);
color:var(--text);
min-height:100vh;
}

/* TOP */
.top-bar{
background:var(--panel2);
padding:10px 40px;
display:flex;
justify-content:space-between;
border-bottom:1px solid #1c2340;
}
.logo{font-size:20px;font-weight:600}
.profile{display:flex;gap:12px;align-items:center;color:var(--muted)}
.profile img{width:32px;height:32px;border-radius:50%;border:2px solid var(--accent)}

/* NAV */
.nav-bar{
display:flex;
gap:20px;
padding:14px 40px;
background:var(--panel);
border-bottom:1px solid #1c2340;
}
.nav-item{
color:var(--muted);
text-decoration:none;
padding:8px 14px;
border-radius:10px;
transition:.2s;
}
.nav-item:hover{
background:#1a2550;
color:#fff;
box-shadow:0 0 0 1px rgba(79,124,255,.4);
}
.nav-item.active{
background:var(--accent);
color:#fff;
}

/* HEADER */
.header{
padding:24px 40px;
display:flex;
justify-content:space-between;
align-items:center;
border-bottom:1px solid #1c2340;
}
.budget{
background:var(--panel);
padding:8px 14px;
border-radius:12px;
}
.budget input{
background:none;border:none;color:var(--text);
width:110px;text-align:right;
outline:none;
}

/* LAYOUT */
main{
padding:40px;
display:grid;
grid-template-columns:2.6fr 1fr;
gap:30px;
}

/* PARTS */
.parts,.summary{
background:var(--panel);
border-radius:14px;
padding:26px;
}

.row{
display:grid;
grid-template-columns:140px 1fr 120px;
gap:14px;
padding:14px 0;
border-bottom:1px solid #1d2440;
}

.choose{
background:var(--panel2);
border:1px solid #222b52;
color:#fff;
padding:12px;
border-radius:12px;
cursor:pointer;
transition:.2s;
text-align:center;
}
.choose:hover{
background:#1f2a55;
box-shadow:0 0 0 1px var(--accent);
}
.price{text-align:right;color:var(--muted)}

button{
padding:14px;
border:none;
border-radius:12px;
font-weight:600;
cursor:pointer;
transition:.2s;
color:#fff;
}
button:hover{
filter:brightness(1.15);
box-shadow:0 0 0 1px rgba(255,255,255,.15);
}

.clear{
background:var(--danger);
width:100%;
margin-top:20px;
}

/* SUMMARY */
.total{
display:flex;
justify-content:space-between;
font-size:20px;
margin-bottom:14px;
}
.box{
background:#13203f;
border:1px solid #23336d;
padding:12px;
border-radius:10px;
font-size:13px;
margin-bottom:12px;
white-space:pre-line;
}
.summary-actions{
display:grid;
grid-template-columns:1fr 1fr;
gap:14px;
margin-top:16px;
}
.check{background:linear-gradient(135deg,#28c76f,#3fe08f)}
.save{background:linear-gradient(135deg,#4f7cff,#6fa3ff)}

/* MODAL (matches site) */
.modal{
position:fixed;
inset:0;
background:rgba(6,9,20,.75);
display:none;
align-items:center;
justify-content:center;
z-index:1000;
}
.modal-box{
background:var(--panel);
border-radius:16px;
padding:20px;
width:980px;
max-width:96%;
max-height:84vh;
border:1px solid #1c2340;
display:flex;
flex-direction:column;
}
.modal-top{
display:flex;
justify-content:space-between;
align-items:center;
gap:14px;
padding-bottom:14px;
border-bottom:1px solid #1d2440;
}
.modal-title{
font-weight:700;
letter-spacing:.2px;
}
.modal-x{
cursor:pointer;
color:var(--muted);
padding:8px 12px;
border-radius:10px;
background:transparent;
border:1px solid #222b52;
}
.modal-x:hover{
color:#fff;
background:#1a2550;
box-shadow:0 0 0 1px rgba(79,124,255,.35);
}

.modal-controls{
display:grid;
grid-template-columns:1.4fr .8fr .8fr .9fr;
gap:10px;
margin-top:14px;
}
.modal-controls input,
.modal-controls select{
background:var(--panel2);
border:1px solid #222b52;
color:var(--text);
padding:10px 12px;
border-radius:12px;
outline:none;
}
.modal-controls input::placeholder{color:#6f7890}

.modal-meta{
margin-top:10px;
display:flex;
justify-content:space-between;
color:var(--muted);
font-size:12px;
}

.modal-grid{
margin-top:14px;
display:grid;
grid-template-columns:repeat(3, 1fr);
gap:14px;
overflow:auto;
padding-right:6px;
}

.card{
background:var(--panel2);
border:1px solid #222b52;
border-radius:14px;
padding:14px;
cursor:pointer;
transition:.2s;
display:flex;
flex-direction:column;
gap:10px;
min-height:120px;
}
.card:hover{
background:#1f2a55;
box-shadow:0 0 0 1px var(--accent);
}
.card .name{font-weight:700;font-size:13.5px;line-height:1.25}
.card .sub{color:var(--muted);font-size:12px;line-height:1.2}
.card .bottom{
display:flex;
justify-content:space-between;
align-items:flex-end;
margin-top:auto;
}
.badge{
font-size:11px;
padding:4px 8px;
border-radius:999px;
border:1px solid #2a3566;
color:#cdd5ff;
background:#111a33;
}
.price2{
font-weight:800;
color:#a9c3ff;
}

/* FOOTER */
.footer{
margin-top:60px;
border-top:1px solid #1c2340;
background:rgba(10,14,30,.8);
}
.footer-inner{
max-width:1200px;
margin:auto;
padding:20px 40px;
display:flex;
justify-content:space-between;
color:var(--muted);
font-size:13px;
}
</style>
</head>

<body>

<div class="top-bar">
  <div class="logo">PCPartsHub</div>
  <div class="profile"><img src="https://i.pravatar.cc/32"> Ahmed</div>
</div>

<nav class="nav-bar">
  <a class="nav-item active">Builder</a>
  <a href="pcready.html" class="nav-item">Completed</a>
  <a href="graph.html" class="nav-item">Graphs</a>
</nav>

<div class="header">
  <h2>Advanced PC Builder</h2>
  <div class="budget">
    Budget DH
    <input id="budgetInput" type="number" value="15000">
  </div>
</div>

<main>
  <section class="parts">
    <h3>Configuration</h3><br>

    <div class="row" data-part="cpu">
      <div>CPU</div>
      <div class="choose" onclick="openModal(this)">Choose</div>
      <div id="cpuP" class="price">—</div>
    </div>

    <div class="row" data-part="mb">
      <div>Motherboard</div>
      <div class="choose" onclick="openModal(this)">Choose</div>
      <div id="mbP" class="price">—</div>
    </div>

    <div class="row" data-part="gpu">
      <div>GPU</div>
      <div class="choose" onclick="openModal(this)">Choose</div>
      <div id="gpuP" class="price">—</div>
    </div>

    <div class="row" data-part="ram">
      <div>RAM</div>
      <div class="choose" onclick="openModal(this)">Choose</div>
      <div id="ramP" class="price">—</div>
    </div>

    <div class="row" data-part="storage">
      <div>Storage</div>
      <div class="choose" onclick="openModal(this)">Choose</div>
      <div id="storageP" class="price">—</div>
    </div>

    <div class="row" data-part="psu">
      <div>PSU</div>
      <div class="choose" onclick="openModal(this)">Choose</div>
      <div id="psuP" class="price">—</div>
    </div>

    <div class="row" data-part="case">
      <div>Case</div>
      <div class="choose" onclick="openModal(this)">Choose</div>
      <div id="caseP" class="price">—</div>
    </div>

    <button class="clear" id="clearBtn">Clear configuration</button>
  </section>

  <aside class="summary">
    <h3>Summary</h3><br>

    <div class="total">
      <span>Total</span>
      <span id="totalEl">0 DH</span>
    </div>

    <div class="box" id="compatBox">Compatibility: —</div>
    <div class="box" id="powerBox">Power: —</div>

    <div class="summary-actions">
      <button class="check" id="checkBtn">Check</button>
      <button class="save" id="saveBtn">Save</button>
    </div>
  </aside>
</main>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <div class="modal-top">
      <div class="modal-title" id="modalTitle">Select</div>
      <button class="modal-x" onclick="closeModal()">✕</button>
    </div>

    <div class="modal-controls">
      <input id="searchInput" type="text" placeholder="Search (e.g. RTX, Ryzen, DDR5, MSI)">
      <select id="brandFilter"></select>
      <input id="maxPriceInput" type="number" placeholder="Max price (DH)">
      <select id="sortSelect">
        <option value="rec">Recommended</option>
        <option value="plh">Price: Low → High</option>
        <option value="phl">Price: High → Low</option>
      </select>
    </div>

    <div class="modal-meta">
      <span id="resultsMeta">0 results</span>
      <span>Click a card to select</span>
    </div>

    <div class="modal-grid" id="modalGrid"></div>
  </div>
</div>

<footer class="footer">
  <div class="footer-inner">
    <span>© 2026 PCPartsHub</span>
    <span>Morocco PC Parts Price Comparator</span>
  </div>
</footer>

<script>
/* ===== Original real product dataset (from your original code) ===== */
const data = {
  cpu:[
    {id:"i5_12400",n:"Intel i5-12400",p:1800,socket:"LGA1700",w:65},
    {id:"i7_12700",n:"Intel i7-12700K",p:3200,socket:"LGA1700",w:125},
    {id:"r5_5600",n:"Ryzen 5 5600",p:1700,socket:"AM4",w:65},
    {id:"r7_7700",n:"Ryzen 7 7700X",p:3800,socket:"AM5",w:105}
  ],
  mb:[
    {id:"b660",n:"MSI B660 (LGA1700 DDR4)",p:1400,socket:"LGA1700",ram:"DDR4",w:25},
    {id:"z690",n:"ASUS Z690 (LGA1700 DDR5)",p:2200,socket:"LGA1700",ram:"DDR5",w:30},
    {id:"b550",n:"Gigabyte B550 (AM4 DDR4)",p:1300,socket:"AM4",ram:"DDR4",w:22},
    {id:"x670",n:"ASRock X670 (AM5 DDR5)",p:2600,socket:"AM5",ram:"DDR5",w:35}
  ],
  gpu:[
    {id:"rtx3060",n:"RTX 3060",p:3500,w:170},
    {id:"rtx4070",n:"RTX 4070",p:6500,w:200},
    {id:"rx6700",n:"RX 6700XT",p:4200,w:230},
    {id:"rx7800",n:"RX 7800XT",p:7000,w:260}
  ],
  ram:[
    {id:"16ddr4",n:"16GB DDR4",p:700,type:"DDR4",w:5},
    {id:"32ddr4",n:"32GB DDR4",p:1200,type:"DDR4",w:7},
    {id:"16ddr5",n:"16GB DDR5",p:1200,type:"DDR5",w:6},
    {id:"32ddr5",n:"32GB DDR5",p:2000,type:"DDR5",w:8}
  ],
  storage:[
    {id:"ssd1",n:"NVMe SSD 1TB",p:900,w:5},
    {id:"ssd2",n:"NVMe SSD 2TB",p:1600,w:6},
    {id:"hdd2",n:"HDD 2TB",p:700,w:7}
  ],
  psu:[
    {id:"650",n:"650W Bronze",p:700,psuW:650},
    {id:"750",n:"750W Gold",p:1000,psuW:750},
    {id:"850",n:"850W Gold",p:1400,psuW:850}
  ],
  case:[
    {id:"nzxt",n:"NZXT H510",p:700},
    {id:"corsair",n:"Corsair 4000D",p:800},
    {id:"lianli",n:"Lian Li O11",p:1400}
  ]
};

/* ===== Helpers ===== */
function getBrand(name){
  const s = name.toLowerCase();
  if(s.includes("intel")) return "Intel";
  if(s.includes("ryzen")) return "AMD";
  if(s.includes("msi")) return "MSI";
  if(s.includes("asus")) return "ASUS";
  if(s.includes("gigabyte")) return "Gigabyte";
  if(s.includes("asrock")) return "ASRock";
  if(s.includes("rtx") || s.includes("nvidia")) return "NVIDIA";
  if(s.includes("rx") || s.includes("radeon")) return "AMD Radeon";
  if(s.includes("nzxt")) return "NZXT";
  if(s.includes("corsair")) return "Corsair";
  if(s.includes("lian li")) return "Lian Li";
  if(s.includes("ssd") || s.includes("hdd") || s.includes("nvme")) return "Storage";
  if(s.includes("gold") || s.includes("bronze") || s.includes("w ")) return "PSU";
  if(s.includes("ddr4")) return "DDR4";
  if(s.includes("ddr5")) return "DDR5";
  return "Other";
}

/* ===== State ===== */
const STORAGE_KEY = "pcpartshub_real_state_v2";

const state = {
  selected: { cpu:null, mb:null, gpu:null, ram:null, storage:null, psu:null, case:null }
};

let activeRow = null;
let activePartKey = null;

/* ===== Modal elements ===== */
const modal = document.getElementById("modal");
const modalTitle = document.getElementById("modalTitle");
const modalGrid = document.getElementById("modalGrid");
const searchInput = document.getElementById("searchInput");
const brandFilter = document.getElementById("brandFilter");
const maxPriceInput = document.getElementById("maxPriceInput");
const sortSelect = document.getElementById("sortSelect");
const resultsMeta = document.getElementById("resultsMeta");

/* ===== Open/Close modal ===== */
function openModal(btn){
  activeRow = btn.closest(".row");
  activePartKey = activeRow.dataset.part;

  modalTitle.textContent = `Select ${activePartKey.toUpperCase()}`;

  // reset controls
  searchInput.value = "";
  maxPriceInput.value = "";

  populateBrandFilter();
  renderModalList();

  modal.style.display = "flex";
}

function closeModal(){
  modal.style.display = "none";
  activeRow = null;
  activePartKey = null;
}

modal.addEventListener("click", (e)=>{
  if(e.target === modal) closeModal();
});

/* ===== Filters ===== */
function populateBrandFilter(){
  const items = data[activePartKey] || [];
  const brands = Array.from(new Set(items.map(i => getBrand(i.n)))).sort();

  brandFilter.innerHTML = `<option value="__all">All brands</option>` +
    brands.map(b => `<option value="${b}">${b}</option>`).join("");
  brandFilter.value = "__all";
}

function applyFilters(items){
  const q = searchInput.value.trim().toLowerCase();
  const b = brandFilter.value;
  const maxP = Number(maxPriceInput.value || 0);
  const sort = sortSelect.value;

  let out = items.slice();

  if(q){
    out = out.filter(i => (i.n || "").toLowerCase().includes(q));
  }
  if(b && b !== "__all"){
    out = out.filter(i => getBrand(i.n) === b);
  }
  if(maxP > 0){
    out = out.filter(i => Number(i.p || 0) <= maxP);
  }

  if(sort === "plh"){
    out.sort((a,c)=> (a.p||0) - (c.p||0));
  }else if(sort === "phl"){
    out.sort((a,c)=> (c.p||0) - (a.p||0));
  }else{
    // "Recommended": keep original order
  }

  return out;
}

function renderModalList(){
  const items = data[activePartKey] || [];
  const filtered = applyFilters(items);

  resultsMeta.textContent = `${filtered.length} result${filtered.length===1?"":"s"}`;

  modalGrid.innerHTML = "";
  filtered.forEach(item=>{
    const brand = getBrand(item.n);
    const badgeText = (() => {
      if(activePartKey === "cpu") return item.socket || brand;
      if(activePartKey === "mb") return `${item.socket || ""} ${item.ram || ""}`.trim();
      if(activePartKey === "ram") return item.type || brand;
      if(activePartKey === "psu") return `${item.psuW || ""}W`.trim();
      return brand;
    })();

    const wattsText = (() => {
      if(activePartKey === "psu") return `${item.psuW || 0}W`;
      return item.w ? `${item.w}W` : "—";
    })();

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <div class="name">${item.n}</div>
      <div class="sub">${activePartKey.toUpperCase()} • ${brand}</div>
      <div class="bottom">
        <span class="badge">${badgeText || "—"}</span>
        <div style="text-align:right">
          <div class="price2">${item.p} DH</div>
          <div class="sub" style="margin-top:2px">${wattsText}</div>
        </div>
      </div>
    `;
    card.onclick = ()=> selectItem(item);
    modalGrid.appendChild(card);
  });
}

/* Live filter events */
searchInput.addEventListener("input", renderModalList);
brandFilter.addEventListener("change", renderModalList);
maxPriceInput.addEventListener("input", renderModalList);
sortSelect.addEventListener("change", renderModalList);

/* ===== Select item ===== */
function selectItem(item){
  if(!activePartKey || !activeRow) return;

  state.selected[activePartKey] = item;

  // Update row button text + price field (keep your layout)
  activeRow.querySelector(".choose").textContent = item.n;
  const priceEl = document.getElementById(activePartKey + "P");
  if(priceEl) priceEl.textContent = `${item.p} DH`;

  recalc();
  closeModal();
}

/* ===== Total + Power ===== */
function recalc(){
  let total = 0;
  let drawW = 0;

  Object.entries(state.selected).forEach(([k,v])=>{
    if(!v) return;
    total += Number(v.p || 0);

    // power draw: sum component watts, PSU is capacity not draw
    if(k === "psu") return;
    drawW += Number(v.w || 0);
  });

  document.getElementById("totalEl").textContent = `${total} DH`;
  document.getElementById("powerBox").textContent = `Power: ${drawW ? drawW + " W" : "—"}`;
}

/* ===== Compatibility check (original rules) ===== */
function checkCompatibility(){
  const cpu = state.selected.cpu;
  const mb  = state.selected.mb;
  const ram = state.selected.ram;
  const psu = state.selected.psu;

  // recompute drawW
  let drawW = 0;
  Object.entries(state.selected).forEach(([k,v])=>{
    if(!v) return;
    if(k === "psu") return;
    drawW += Number(v.w || 0);
  });

  // total
  let total = 0;
  Object.values(state.selected).forEach(v=>{ if(v) total += Number(v.p||0); });

  const budget = Number(document.getElementById("budgetInput").value || 0);
  const issues = [];

  if(cpu && mb && cpu.socket && mb.socket && cpu.socket !== mb.socket){
    issues.push("CPU and Motherboard socket mismatch");
  }
  if(mb && ram && mb.ram && ram.type && mb.ram !== ram.type){
    issues.push("RAM type incompatible");
  }
  if(psu && psu.psuW && drawW > psu.psuW * 0.85){
    issues.push("PSU insufficient (no headroom)");
  }
  if(budget && total > budget){
    issues.push("Over budget");
  }

  document.getElementById("compatBox").textContent =
    issues.length ? `Issues:\n- ${issues.join("\n- ")}` : "Compatibility: Compatible ✓";
}

/* ===== Save / Load / Clear ===== */
function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  alert("Saved");
}

function loadState(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(!raw) return;
  try{
    const saved = JSON.parse(raw);
    if(!saved || !saved.selected) return;

    state.selected = saved.selected;

    // Apply to UI rows
    Object.keys(state.selected).forEach(k=>{
      const v = state.selected[k];
      const row = document.querySelector(`.row[data-part="${CSS.escape(k)}"]`);
      if(!row) return;

      if(v){
        row.querySelector(".choose").textContent = v.n;
        const priceEl = document.getElementById(k + "P");
        if(priceEl) priceEl.textContent = `${v.p} DH`;
      }else{
        row.querySelector(".choose").textContent = "Choose";
        const priceEl = document.getElementById(k + "P");
        if(priceEl) priceEl.textContent = "—";
      }
    });

    recalc();
  }catch(e){}
}

function clearAll(){
  Object.keys(state.selected).forEach(k => state.selected[k] = null);

  document.querySelectorAll(".row").forEach(r=>{
    r.querySelector(".choose").textContent = "Choose";
  });

  ["cpu","mb","gpu","ram","storage","psu","case"].forEach(k=>{
    const priceEl = document.getElementById(k + "P");
    if(priceEl) priceEl.textContent = "—";
  });

  document.getElementById("totalEl").textContent = "0 DH";
  document.getElementById("compatBox").textContent = "Compatibility: —";
  document.getElementById("powerBox").textContent = "Power: —";
}

/* Buttons */
document.getElementById("checkBtn").onclick = checkCompatibility;
document.getElementById("saveBtn").onclick = saveState;
document.getElementById("clearBtn").onclick = clearAll;

/* Init */
loadState();
recalc();
</script>

</body>
</html>
